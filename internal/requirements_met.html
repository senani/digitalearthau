


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>DEA Code Functionality Examples &mdash; Digital Earth Australia 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/dea-favicon.ico"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="What’s a Goalkeeper" href="goalkeeper_instructions.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/DEA-logo-light.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/changelog.html">DEA NCI Environment Changelog</a></li>
</ul>
<p class="caption"><span class="caption-text">Connect</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../connect/account.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connect/install.html">Installation and Software Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connect/nci_basics.html">Command Line Usage (Advanced)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connect/jupyter.html">Jupyter Notebooks Introduction</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../query/Getting Started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query/List Products.html">List Products &amp; Measurements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query/Loading Data.html">Loading data from the datacube</a></li>
<li class="toctree-l1"><a class="reference internal" href="../query/Advanced Querying.html">Advanced Querying</a></li>
</ul>
<p class="caption"><span class="caption-text">Notebook Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../notebooks/index.html">Notebook Gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">Data Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../data/data.html">Surface Reflectance</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="new_product.html">Creating a New Product</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_best_practice.html">Git Best Practice</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">DEA Release Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">DEA Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="other_modules.html">Other Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="orchestration.html">DEA Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="collection_management.html">Collection Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="goalkeeper_instructions.html">What’s a Goalkeeper</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DEA Code Functionality Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Patterns-of-Use:">Patterns of Use:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Remote-Datacube">Remote Datacube</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Test-for-native-projection-query-on-non-standard-rainfall-product">Test for native projection query on non standard rainfall product</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Search-for-dataset-by-location-example">Search for dataset by location example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Plot-WOfS">Plot WOfS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#GQA-based-search">GQA based search</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Confirm-Dashboard-Works">Confirm Dashboard Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Search-with-sources">Search with sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Refine-search-using-sources">Refine search using sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Grid-Cell-count-of-timeslices">Grid Cell count of timeslices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Query-products-by-time-range---return-count">Query products by time range - return count</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Count-for-single-query">Count for single query</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Count-products-through-time">Count products through time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Data-load-examples">Data load examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Load-SRTM">Load SRTM</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Load-Radiometrics">Load Radiometrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Load-NBAR">Load NBAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="#MODIS-Landsat-time-series">MODIS Landsat time series</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Load-rainfall">Load rainfall</a></li>
<li class="toctree-l2"><a class="reference internal" href="#1.-Routine-national-scale-product-generation.-Specifically,-Version-2-will-include-national-collections-of:">1. Routine national scale product generation. Specifically, Version 2 will include national collections of:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Water-Observations-from-Space.">Water Observations from Space.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Multiband-file-or-subdataset-support-example">Multiband file or subdataset support example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Plot-MODIS-timeseries">Plot MODIS timeseries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Query,-load-and-plot-NBART-example">Query, load and plot NBART example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Query,-load-and-plot-WoFS-example">Query, load and plot WoFS example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Construction-of-the-Burdekin-Dam-completed-in-1987">Construction of the Burdekin Dam completed in 1987</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Landsat-Fractional-Cover.">Landsat Fractional Cover.</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Pixel-Quality">Pixel Quality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#NDVI">NDVI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#CLI-Dataset-info,-search">CLI Dataset info, search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#2.-A-user-should-be-able-to-interact-with-these-collections-through-a-web-browser-including:">2. A user should be able to interact with these collections through a web browser including:</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Spatio-temporal-(statistical)-summaries-that-would-allow-users-to-easily-answer-questions-such-as:">Spatio-temporal (statistical) summaries that would allow users to easily answer questions such as:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Earth-Observation-(EO)-scientists-and-allied-domain-specialists-will-be-able-to-undertake-exploratory-data-analysis.-In-general-this-would-mean-a-user-will-be-able-to-easily-retrieve,-investigate,-visualise,-develop-algorithms,-test,-iterate,-visualise-results-and-interpret-them-in-the-context-of-other-spatio-temporal-datasets.">3. Earth Observation (EO) scientists and allied domain specialists will be able to undertake exploratory data analysis. In general this would mean a user will be able to easily retrieve, investigate, visualise, develop algorithms, test, iterate, visualise results and interpret them in the context of other spatio-temporal datasets.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Input-data">Input data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Output-Products">Output Products</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Technical-Requirements">Technical Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="#A-data-retrieval-mechanism-that-provides-the-ability-to:">A data retrieval mechanism that provides the ability to:</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Other-Requirements">Other Requirements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#The-Project-Plan-will-be-supported-by:">The Project Plan will be supported by:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../genindex.html">Tags Index</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Digital Earth Australia</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>DEA Code Functionality Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/internal/requirements_met.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="DEA-Code-Functionality-Examples">
<h1>DEA Code Functionality Examples<a class="headerlink" href="#DEA-Code-Functionality-Examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h2>
<p>A great deal of work has been done by AGDC partners to outline the key
requirements and technical approach for the next version of the AGDC
(Version 2). For example, the previous Technical Working Group held a
workshop that resulted in a draft Preliminary Design Report that has
subsequently been translated to the AGDC wiki ( <a class="reference external" href="http://datacube.org.au">http://datacube.org.au</a>
). Similarly, prototype functionality has been built to test and verify
key concepts for a range of components including the netCDF-4 based
Storage Units that are managed under NCIfs NERDIP data management,
publishing and general access to data protocols; a Generalised Data
Framework (GDF) to access the multidimensional Storage Units; and the
AGDC Analytic Engine adding support for interactive Exploratory Data
Analysis (EDA).</p>
<p>The following requirements for Version 2 have been mainly based off this
thinking and documentation. It is important to note that these
requirements are for the current development effort running through till
June 30, 2016. They are designed to guide and define the next step in
the development of the AGDC, not as the final destination.</p>
<p>Approved Requirements for AGDC Version 2</p>
<p>These requirements were formally approved by the AGDC Programme Board at
its meeting on 10 December, 2015.</p>
</div>
<div class="section" id="Patterns-of-Use:">
<h2>Patterns of Use:<a class="headerlink" href="#Patterns-of-Use:" title="Permalink to this headline">¶</a></h2>
<p>AGDC Version 2 will support the following patterns of use.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">datacube</span>
<span class="kn">from</span> <span class="nn">datacube.model</span> <span class="k">import</span> <span class="n">Range</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">datacube.utils</span> <span class="k">import</span> <span class="n">geometry</span>
<span class="kn">from</span> <span class="nn">datacube.storage</span> <span class="k">import</span> <span class="n">masking</span>
<span class="kn">from</span> <span class="nn">datacube.storage.masking</span> <span class="k">import</span> <span class="n">mask_invalid_data</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">xarray</span>
<span class="kn">import</span> <span class="nn">numpy</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="k">import</span> <span class="n">display</span>
<span class="kn">import</span> <span class="nn">geopandas</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">mapping</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">MultiPolygon</span>
<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span>
<span class="kn">import</span> <span class="nn">shapely.ops</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="c1">#from datacube.model import datacube.utils.geometry.CRS</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="k">import</span> <span class="n">tz</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">notebook_start_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dc</span> <span class="o">=</span> <span class="n">datacube</span><span class="o">.</span><span class="n">Datacube</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="s1">&#39;requirements-met&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datacube</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">datacube</span><span class="o">.</span><span class="n">__path__</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>module list
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>datacube system check
</pre></div>
</div>
</div>
</div>
<div class="section" id="Remote-Datacube">
<h2>Remote Datacube<a class="headerlink" href="#Remote-Datacube" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datacube</span> <span class="k">import</span> <span class="n">Datacube</span>
<span class="n">remotedc</span> <span class="o">=</span> <span class="n">Datacube</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="s1">&#39;/home/547/jps547/.aws_datacube.conf&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">geopy.geocoders</span> <span class="k">import</span> <span class="n">Nominatim</span>
<span class="n">geolocator</span> <span class="o">=</span> <span class="n">Nominatim</span><span class="p">()</span>
<span class="n">location</span> <span class="o">=</span> <span class="n">geolocator</span><span class="o">.</span><span class="n">geocode</span><span class="p">(</span><span class="s2">&quot;Launceston, Tasmania&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">location</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">41.82</span><span class="p">,</span> <span class="o">-</span><span class="mf">41.81</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">146.71</span><span class="p">,</span> <span class="mf">146.72</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">wofs</span> <span class="o">=</span> <span class="n">remotedc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;wofs_modified_albers&#39;</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>

<span class="n">wofs</span><span class="o">.</span><span class="n">water</span><span class="o">.</span><span class="n">flags_definition</span>
<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">masking</span><span class="o">.</span><span class="n">get_flags_def</span><span class="p">(</span><span class="n">wofs</span><span class="p">),</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Throughout this doc we use print() manually rather than returning the object as an output.</span>
<span class="c1"># This is to minimise memory usage: avoid storing a reference to the data array itself in Jupyter&#39;s output history.</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">wofs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wofs</span><span class="o">.</span><span class="n">water</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">remotedc</span><span class="o">.</span><span class="n">list_products</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">water</span> <span class="o">=</span> <span class="n">masking</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">wofs</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="s1">&#39;clear_wet&#39;</span><span class="p">)</span>

<span class="n">water</span><span class="o">.</span><span class="n">water</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">water</span><span class="o">.</span><span class="n">water</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="n">remotedc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;wofs_modified_albers&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata_doc</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">water</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">wofs</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Test-for-native-projection-query-on-non-standard-rainfall-product">
<h2>Test for native projection query on non standard rainfall product<a class="headerlink" href="#Test-for-native-projection-query-on-non-standard-rainfall-product" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="s1">&#39;bom_rainfall_grids&#39;</span><span class="p">,</span>
    <span class="s1">&#39;crs&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:3577&#39;</span><span class="p">,</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1987-10-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1990-10-01&#39;</span><span class="p">),</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">349388.9787330463</span><span class="p">,</span> <span class="mf">358497.9246628304</span><span class="p">),</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2379960.5883129314</span><span class="p">,</span> <span class="o">-</span><span class="mf">2375926.544118764</span><span class="p">),</span>
    <span class="s1">&#39;output_crs&#39;</span><span class="p">:</span> <span class="s1">&#39;EPSG:3577&#39;</span><span class="p">,</span>
    <span class="s1">&#39;resolution&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
    <span class="s1">&#39;resampling&#39;</span><span class="p">:</span> <span class="s1">&#39;cubic&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">rainfall_projected</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="o">**</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">rainfall_projected</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rainfall_projected</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Search-for-dataset-by-location-example">
<h2>Search for dataset by location example<a class="headerlink" href="#Search-for-dataset-by-location-example" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Was replaced by stacked file</span>
<span class="c1"># ds_uri = &#39;file:///g/data/rs0/datacube/002/LS5_TM_NBART/-7_-30/LS5_TM_NBART_3577_-7_-30_20030711011529000000_v1488078639.nc&#39;</span>

<span class="n">ds_uri</span> <span class="o">=</span> <span class="s1">&#39;file:///g/data/rs0/datacube/002/LS5_TM_NBAR/13_-35/LS5_TM_NBAR_3577_13_-35_2009_v1496827052.nc&#39;</span>
<span class="n">datasets_in_stack</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_datasets_for_location</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">ds_uri</span><span class="p">))</span>

<span class="c1"># If restacked, there will be a newer file (with higher vXXX version suffix)</span>
<span class="c1"># So this one shouldn&#39;t change:</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">datasets_in_stack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">74</span>
<span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets_in_stack</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">datasets_in_stack</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="n">datasets_in_stack</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">chop_to_globe</span><span class="p">(</span><span class="n">geom</span><span class="p">):</span>
    <span class="n">to_crs</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
    <span class="n">left_of_dt</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mf">1.0e-8</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">180</span> <span class="o">-</span> <span class="mf">1.0e-8</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">crs</span><span class="o">=</span><span class="n">to_crs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

    <span class="n">right_of_dt</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">line</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="mf">1.0e-8</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="mf">1.0e-8</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">crs</span><span class="o">=</span><span class="n">to_crs</span>
    <span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>

    <span class="n">chopper</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span>
        <span class="n">left_of_dt</span><span class="o">.</span><span class="n">points</span> <span class="o">+</span> <span class="n">right_of_dt</span><span class="o">.</span><span class="n">points</span> <span class="o">+</span> <span class="p">[</span><span class="n">left_of_dt</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">crs</span><span class="o">=</span><span class="n">geom</span><span class="o">.</span><span class="n">crs</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">geom</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">chopper</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">datasets_union_clip180</span><span class="p">(</span><span class="n">dss</span><span class="p">):</span>
    <span class="n">thing</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">extent</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">dss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">chop_to_globe</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">datasets_union</span><span class="p">(</span><span class="n">dss</span><span class="p">):</span>
    <span class="n">thing</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">unary_union</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">extent</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">dss</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">thing</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">thing</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">random</span>
<span class="k">def</span> <span class="nf">plot_folium</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>

    <span class="n">mapa</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="n">location</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">150</span><span class="p">],</span> <span class="n">zoom_start</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">,</span> <span class="s1">&#39;#ff0000&#39;</span><span class="p">,</span> <span class="s1">&#39;#00ffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#000000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ff00ff&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
        <span class="n">style_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;fillColor&#39;</span><span class="p">:</span> <span class="s1">&#39;#000000&#39;</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Polygon&#39;</span> <span class="k">else</span> <span class="s1">&#39;#00ff00&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;color&#39;</span> <span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">colors</span><span class="p">)}</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">folium</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">GeoJson</span><span class="p">(</span><span class="n">mapping</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="n">style_function</span><span class="o">=</span><span class="n">style_function</span><span class="p">)</span>
        <span class="n">mapa</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">mapa</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot_rgb</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">fake_saturation</span><span class="p">):</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">mask_invalid_data</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">to_array</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">)</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">rgb</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">rgb</span><span class="o">.</span><span class="n">dims</span><span class="p">[:</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># make &#39;color&#39; the last dimension</span>
    <span class="n">rgb</span> <span class="o">=</span> <span class="n">rgb</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">rgb</span> <span class="o">&lt;=</span> <span class="n">fake_saturation</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">))</span>  <span class="c1"># mask out pixels where any band is &#39;saturated&#39;</span>
    <span class="n">rgb</span> <span class="o">/=</span> <span class="n">fake_saturation</span>  <span class="c1"># scale to [0, 1] range for imshow</span>

    <span class="n">rgb</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">y</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
        <span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-WOfS">
<h2>Plot WOfS<a class="headerlink" href="#Plot-WOfS" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">remotedc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls7_wofs_pq_scene&#39;</span><span class="p">,</span> <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="GQA-based-search">
<h2>GQA based search<a class="headerlink" href="#GQA-based-search" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Get NBAR where source level1 matches a certain quality</span>

<span class="n">source_filter</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls8_level1_scene&#39;</span><span class="p">,</span> <span class="n">gqa_cep90</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">datacube</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls8_nbar_albers&#39;</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2015-02-01&#39;</span><span class="p">),</span>
    <span class="n">source_filter</span><span class="o">=</span><span class="n">source_filter</span>
<span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span><span class="o">**</span><span class="n">query</span><span class="o">.</span><span class="n">search_terms</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Confirm-Dashboard-Works">
<h2>Confirm Dashboard Works<a class="headerlink" href="#Confirm-Dashboard-Works" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Dashboard view of current production status per product with Spatial, Tabular and Reference views</span>
<span class="c1">#!/g/data/v10/public/run-dash.sh</span>
<span class="c1">#!firefox http://127.0.0.1:8080/</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Search-with-sources">
<h2>Search with sources<a class="headerlink" href="#Search-with-sources" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="p">(</span>
     <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;11228944-42f6-4b9f-a434-73e0c7f9bde2&#39;</span><span class="p">,</span> <span class="n">include_sources</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">metadata_doc</span><span class="p">[</span><span class="s1">&#39;lineage&#39;</span><span class="p">][</span><span class="s1">&#39;source_datasets&#39;</span><span class="p">][</span><span class="s1">&#39;0&#39;</span><span class="p">][</span><span class="s1">&#39;lineage&#39;</span><span class="p">][</span><span class="s1">&#39;source_datasets&#39;</span><span class="p">][</span><span class="s1">&#39;level1&#39;</span><span class="p">][</span><span class="s1">&#39;gqa&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Refine-search-using-sources">
<h2>Refine search using sources<a class="headerlink" href="#Refine-search-using-sources" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datacube.model</span> <span class="k">import</span> <span class="n">Range</span>
<span class="n">results</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ls5_level1_scene&#39;</span><span class="p">]:</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
        <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span>
        <span class="n">sat_path</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">91</span><span class="p">,</span><span class="mi">92</span><span class="p">),</span>
        <span class="n">sat_row</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">88</span><span class="p">,</span><span class="mi">90</span><span class="p">),</span>
    <span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">local_path</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">datacube.model</span> <span class="k">import</span> <span class="n">Range</span>
<span class="n">time_range</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls8_nbar_albers&#39;</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="n">time_range</span><span class="p">,</span>
    <span class="n">source_filter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls8_level1_scene&#39;</span><span class="p">,</span>
        <span class="n">sat_path</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">87</span><span class="p">,</span><span class="mi">116</span><span class="p">),</span>
        <span class="n">sat_row</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="mi">67</span><span class="p">,</span><span class="mi">91</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">metadata_doc</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Grid-Cell-count-of-timeslices">
<h2>Grid Cell count of timeslices<a class="headerlink" href="#Grid-Cell-count-of-timeslices" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;ls8_nbar_albers&#39;</span>

<span class="n">gw</span> <span class="o">=</span> <span class="n">datacube</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">GridWorkflow</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
<span class="n">cells</span> <span class="o">=</span> <span class="n">gw</span><span class="o">.</span><span class="n">list_cells</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2016-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2017-01-01&#39;</span><span class="p">))</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">cells</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">cells</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Query-products-by-time-range---return-count">
<h2>Query products by time range - return count<a class="headerlink" href="#Query-products-by-time-range---return-count" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Count-for-single-query">
<h3>Count for single query<a class="headerlink" href="#Count-for-single-query" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Count of single query</span>
<span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;ls7_nbar_scene&#39;</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">count</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Single product </span><span class="si">{}</span><span class="s2"> count of </span><span class="si">{}</span><span class="s2"> in </span><span class="si">{}</span><span class="s2"> seconds ---&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Count-products-through-time">
<h3>Count products through time<a class="headerlink" href="#Count-products-through-time" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">count_by_product_through_time</span><span class="p">(</span>
    <span class="s1">&#39;1 year&#39;</span><span class="p">,</span>
    <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;LANDSAT_7&#39;</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">datetime</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="c1">#, tzinfo=tz.tzutc()),</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">start_product_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">series</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1"> seconds&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_product_time</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">timerange</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">series</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">timerange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">count</span><span class="p">))</span>
    <span class="n">start_product_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--- </span><span class="si">%s</span><span class="s2"> seconds ---&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">))</span>

</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Data-load-examples">
<h2>Data load examples<a class="headerlink" href="#Data-load-examples" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dc</span><span class="o">.</span><span class="n">list_measurements</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-SRTM">
<h2>Load SRTM<a class="headerlink" href="#Load-SRTM" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">20.61</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.66</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">147.0</span><span class="p">,</span> <span class="mf">147.05</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">srtm_dem1sv1_0</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;srtm_dem1sv1_0&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">srtm_dem1sv1_0</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">srtm_dem1sv1_0</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-Radiometrics">
<h2>Load Radiometrics<a class="headerlink" href="#Load-Radiometrics" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">20.61</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.66</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">147.0</span><span class="p">,</span> <span class="mf">147.05</span><span class="p">),</span>
    <span class="s1">&#39;measurements&#39;</span><span class="p">:[</span><span class="s1">&#39;rad_k_equiv_conc_filtered&#39;</span><span class="p">,</span><span class="s1">&#39;rad_th_equiv_conc_filtered&#39;</span><span class="p">,</span><span class="s1">&#39;rad_u_equiv_conc_filtered&#39;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Gamma ray no longer available at indexed location?</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">radiometrics</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;gamma_ray&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>

    <span class="c1"># Previously: array(3.2456936836242676)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">radiometrics</span><span class="o">.</span><span class="n">rad_u_equiv_conc_filtered</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>


    <span class="nb">print</span><span class="p">(</span><span class="n">radiometrics</span><span class="p">)</span>
    <span class="n">plot_rgb</span><span class="p">(</span><span class="n">radiometrics</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">radiometrics</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-NBAR">
<h2>Load NBAR<a class="headerlink" href="#Load-NBAR" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nbar</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbart_albers&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">18.7896944682</span><span class="p">,</span><span class="o">-</span><span class="mf">18.7896944684</span><span class="p">),</span>
    <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mf">146.073501475</span><span class="p">,</span><span class="mf">146.073501476</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">nbar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nbar</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="MODIS-Landsat-time-series">
<h2>MODIS Landsat time series<a class="headerlink" href="#MODIS-Landsat-time-series" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">modis</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;modis_mcd43a4_tile&#39;</span><span class="p">,</span>
    <span class="n">longitude</span><span class="o">=</span><span class="mf">132.1</span><span class="p">,</span>
    <span class="n">latitude</span><span class="o">=-</span><span class="mf">27.5</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2000-1-1&#39;</span><span class="p">,</span> <span class="s1">&#39;2000-5-1&#39;</span><span class="p">),</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">),</span>
    <span class="c1"># measurements=(&#39;Nadir_Reflectance_Band1&#39;,&#39;Nadir_Reflectance_Band4&#39;,&#39;Nadir_Reflectance_Band3&#39;),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Josh archived all of this product.</span>
<span class="c1">#modis.Nadir_Reflectance_Band1.min()</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">modis</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

<span class="nb">print</span><span class="p">(</span><span class="n">modis</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">modis</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-rainfall">
<h2>Load rainfall<a class="headerlink" href="#Load-rainfall" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rain</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;bom_rainfall_grids&#39;</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mf">132.1</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=-</span><span class="mf">27.5</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2000-1-1&#39;</span><span class="p">,</span> <span class="s1">&#39;2001-1-1&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rain</span><span class="o">.</span><span class="n">rainfall</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mf">132.1</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=-</span><span class="mf">27.500001</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rain</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="1.-Routine-national-scale-product-generation.-Specifically,-Version-2-will-include-national-collections-of:">
<h2>1. Routine national scale product generation. Specifically, Version 2 will include national collections of:<a class="headerlink" href="#1.-Routine-national-scale-product-generation.-Specifically,-Version-2-will-include-national-collections-of:" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Water-Observations-from-Space.">
<h3>Water Observations from Space.<a class="headerlink" href="#Water-Observations-from-Space." title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;srtm_dem1sv1_0&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rain_ds</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;bom_rainfall_grids&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

<span class="n">datasets_union_clip180</span><span class="p">(</span><span class="n">rain_ds</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">CRS</span><span class="p">(</span><span class="s1">&#39;EPSG:3577&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rain_ds</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union_clip180</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;bom_rainfall_grids&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;srtm_dem1sv1_0&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Josh archived all of this</span>
<span class="n">modis_mcd43a4</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;modis_mcd43a4_tile&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">145</span><span class="p">,</span><span class="mf">145.1</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">38.0</span><span class="p">,</span><span class="o">-</span><span class="mf">38.1</span><span class="p">),</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2000-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2001-01-01&#39;</span><span class="p">),</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">(</span>
        <span class="s1">&#39;Nadir_Reflectance_Band1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Nadir_Reflectance_Band4&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Nadir_Reflectance_Band3&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">modis_mcd43a4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">modis_mcd43a4</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Multiband-file-or-subdataset-support-example">
<h3>Multiband file or subdataset support example<a class="headerlink" href="#Multiband-file-or-subdataset-support-example" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">script</span> false
# Modis disabled. Josh archived all of this

modis_mcd43a1 = dc.load(
    product=&#39;modis_mcd43a1_tile&#39;,
    x=(145,145.1),
    y=(-38.0,-38.1),
    resolution=(-500,500),
    time=(&#39;2001-01-01&#39;, &#39;2001-01-01&#39;),
    measurements=(
        &#39;BRDF_Albedo_Parameters_Band1&#39;,
        &#39;BRDF_Albedo_Parameters_Band2&#39;,
        &#39;BRDF_Albedo_Parameters_Band3&#39;
    )
)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># modis_mcd43a1.BRDF_Albedo_Parameters_Band1[0][1]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># plot_rgb(modis_mcd43a1, 1000)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-MODIS-timeseries">
<h3>Plot MODIS timeseries<a class="headerlink" href="#Plot-MODIS-timeseries" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># plot_rgb(modis_mcd43a4, 3000)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># plot_folium([datasets_union(dc.index.datasets.search_eager(product=&#39;ls5_nbart_albers&#39;, time=Range(datetime(1986, 1, 1), datetime(1988, 1, 1))))])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Query,-load-and-plot-NBART-example">
<h3>Query, load and plot NBART example<a class="headerlink" href="#Query,-load-and-plot-NBART-example" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1987-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1988-01-01&#39;</span><span class="p">),</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.4</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.0</span><span class="p">,</span> <span class="mf">149.2</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">nbart</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbart_albers&#39;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;swir2&#39;</span><span class="p">,</span> <span class="s1">&#39;nir&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span>
    <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span> <span class="p">,</span>
    <span class="o">**</span><span class="n">query</span>
<span class="p">)</span>

<span class="n">plot_rgb</span><span class="p">(</span><span class="n">nbart</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nbart</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Query,-load-and-plot-WoFS-example">
<h3>Query, load and plot WoFS example<a class="headerlink" href="#Query,-load-and-plot-WoFS-example" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Construction-of-the-Burdekin-Dam-completed-in-1987">
<h4>Construction of the Burdekin Dam completed in 1987<a class="headerlink" href="#Construction-of-the-Burdekin-Dam-completed-in-1987" title="Permalink to this headline">¶</a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">script</span> false
# Disabled: WOfS has been removed.

query = {
    &#39;time&#39;: (&#39;1986-01-01&#39;, &#39;1988-01-01&#39;),
    &#39;lat&#39;: (-20.61, -20.67),
    &#39;lon&#39;: (147.0, 147.15),
}

wofs = dc.load(product=&#39;wofs_albers&#39;, group_by=&#39;solar_day&#39;, **query)
wofs
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">script</span> false
wofs.water.flags_definition
pandas.DataFrame.from_dict(masking.get_flags_def(wofs), orient=&#39;index&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">script</span> false

water = masking.make_mask(wofs, result=&#39;clear_wet&#39;)
water.water.plot(col=&#39;time&#39;, col_wrap=5, robust=True, cmap=&#39;gray&#39;)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%</span><span class="k">script</span> false
# Number of clear water pixels - no group by solar day to exclude scene overlap

water_sum = water.water.sum(&#39;time&#39;).where(water.water.sum(&#39;time&#39;)!= 0)
water_sum.plot(cmap=&#39;rainbow&#39;, robust=True)
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wofs</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">water</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">water_sum</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<p>Intertidal Characterisation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># incomplete for v2 - water classification only - confidence metrics continue to be a work in progress</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Landsat-Fractional-Cover.">
<h3>Landsat Fractional Cover.<a class="headerlink" href="#Landsat-Fractional-Cover." title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_fc_albers&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1987</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Query, load and plot Fractional Cover example</span>

<span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;1987-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;1988-01-01&#39;</span><span class="p">),</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.4</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.0</span><span class="p">,</span> <span class="mf">149.2</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">fractional_cover</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_fc_albers&#39;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;BS&#39;</span><span class="p">,</span> <span class="s1">&#39;PV&#39;</span><span class="p">,</span> <span class="s1">&#39;NPV&#39;</span><span class="p">],</span>
    <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span> <span class="p">,</span>
    <span class="o">**</span><span class="n">query</span>
<span class="p">)</span>

<span class="n">plot_rgb</span><span class="p">(</span><span class="n">fractional_cover</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fractional_cover</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Pixel-Quality">
<h3>Pixel Quality<a class="headerlink" href="#Pixel-Quality" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_pq_albers&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1987</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls7_nbar_albers&#39;</span><span class="p">,</span>
           <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2004</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2004</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pq</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_pq_albers&#39;</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>
<span class="n">pq</span><span class="o">.</span><span class="n">pixelquality</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Number of clear pixels based on ga_good_pixels default - no group by solar day to exclude scene overlap</span>
<span class="n">clear_pixels</span> <span class="o">=</span> <span class="n">masking</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">pq</span><span class="p">,</span> <span class="n">ga_good_pixel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">clear_pixels</span><span class="o">.</span><span class="n">pixelquality</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">clear_pixels</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="NDVI">
<h3>NDVI<a class="headerlink" href="#NDVI" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_ndvi_albers&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1987</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#ndvi = dc.load(product=&#39;ls5_ndvi_albers&#39;, group_by=&#39;solar_day&#39;, **query )</span>
<span class="c1">#ndvi = mask_invalid_data(ndvi)</span>
<span class="n">good_pixels</span> <span class="o">=</span> <span class="n">masking</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">pq</span><span class="p">,</span> <span class="n">ga_good_pixel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1">#ndvi = ndvi.where(good_pixels.pixelquality)</span>
<span class="c1">#ndvi.ndvi.plot(col=&#39;time&#39;, col_wrap=5, robust=True, cmap=&#39;Greens&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">good_pixels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Landsat Surface reflectance statistical summaries:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Seasonal</span> <span class="n">medians</span><span class="p">;</span> <span class="ow">and</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#ndvi.ndvi.median(dim=&#39;time&#39;).plot(robust=True, cmap=&#39;YlGn&#39;)</span>
</pre></div>
</div>
</div>
<p>Most-up-to-date observation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Most recent pixel mosaic function from cloud screen NBAR</span>
<span class="c1">#%run /g/data/v10/public/agdcv2_requirements/latest_pixel/agdc_pixel/pixel_test.py &#39;60/(15,-40)&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#my_data</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#my_data[15, -40].swir1.plot(cmap=&#39;rainbow&#39;, robust=True)</span>
</pre></div>
</div>
</div>
<p>In some cases, these collections may be virtual, i.e. they are not
pre-computed but rather computed as they are needed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">nbar</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span> <span class="p">)</span>
<span class="n">nbar</span> <span class="o">=</span> <span class="n">nbar</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">good_pixels</span><span class="o">.</span><span class="n">pixelquality</span><span class="p">)</span>
<span class="n">ndvi_on_the_fly</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbar</span><span class="o">.</span><span class="n">nir</span><span class="o">-</span><span class="n">nbar</span><span class="o">.</span><span class="n">red</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">nbar</span><span class="o">.</span><span class="n">nir</span><span class="o">+</span><span class="n">nbar</span><span class="o">.</span><span class="n">red</span><span class="p">)</span><span class="o">*</span><span class="mi">10000</span>
<span class="n">ndvi_on_the_fly</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGn&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># diff = (ndvi_on_the_fly.median(dim=&#39;time&#39;) - ndvi.ndvi.median(dim=&#39;time&#39;))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># diff.plot(robust=True) #error at level of noise due to *10000 scaling of floats</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="CLI-Dataset-info,-search">
<h3>CLI Dataset info, search<a class="headerlink" href="#CLI-Dataset-info,-search" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span> datacube dataset info 92d414d0-3d82-4702-9e24-4af6e49d95b5
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span> datacube dataset info -f csv 92d414d0-3d82-4702-9e24-4af6e49d95b5
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>! datacube dataset search \
            product=ls8_level1_scene \
           &quot;time in range (2015-3-2, 2015-3-19)&quot; \
            sat_path=112 \
            sat_row=75
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="2.-A-user-should-be-able-to-interact-with-these-collections-through-a-web-browser-including:">
<h2>2. A user should be able to interact with these collections through a web browser including:<a class="headerlink" href="#2.-A-user-should-be-able-to-interact-with-these-collections-through-a-web-browser-including:" title="Permalink to this headline">¶</a></h2>
<p> Clicking on a pixel and displaying a time series (i.e., pixel
drill).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># See Steven Ackerley / Andrew Hicks</span>
<span class="c1"># NCML through THREDDS</span>
<span class="c1">#!/g/data/v10/public/agdcv2-pixeldrill/pixeldrill -p ls5_nbart_albers</span>

<span class="c1">#Webpage to define it</span>
<span class="o">!</span>firefox http://dapds00.nci.org.au/thredds/ncss/grid/uc0/rs0_dev/all_the_ncmls/LS5_TM_FC/ncml/LS5_TM_FC_13_-43.ncml/pointDataset.html
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#CSV URL for a drill</span>
<span class="o">!</span>firefox http://dapds00.nci.org.au/thredds/ncss/uc0/rs0_dev/all_the_ncmls/LS5_TM_FC/ncml/LS5_TM_FC_13_-43.ncml?var<span class="o">=</span>BS<span class="p">&amp;</span><span class="nv">var</span><span class="o">=</span>NPV<span class="p">&amp;</span><span class="nv">var</span><span class="o">=</span>PV<span class="p">&amp;</span><span class="nv">latitude</span><span class="o">=</span>-38.13<span class="p">&amp;</span><span class="nv">longitude</span><span class="o">=</span><span class="m">147</span>.17<span class="p">&amp;</span><span class="nv">time_start</span><span class="o">=</span><span class="m">1986</span>-08-21T23%3A18%3A40Z<span class="p">&amp;</span><span class="nv">time_end</span><span class="o">=</span><span class="m">2011</span>-11-14T23%3A45%3A07Z<span class="p">&amp;</span><span class="nv">accept</span><span class="o">=</span>csv

</pre></div>
</div>
</div>
<div class="section" id="Spatio-temporal-(statistical)-summaries-that-would-allow-users-to-easily-answer-questions-such-as:">
<h3>Spatio-temporal (statistical) summaries that would allow users to easily answer questions such as:<a class="headerlink" href="#Spatio-temporal-(statistical)-summaries-that-would-allow-users-to-easily-answer-questions-such-as:" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">How</span> <span class="n">frequently</span> <span class="n">was</span> <span class="n">water</span> <span class="n">observed</span> <span class="n">over</span> <span class="n">catchment</span> <span class="n">y</span> <span class="n">during</span> <span class="n">time</span> <span class="n">period</span> <span class="n">x</span><span class="p">;</span> <span class="ow">and</span>
</pre></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># not this time - you mean wofs right? - see example below for when the data is available</span>
</pre></div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>What was the surface reflectance for area x at time y?
</pre></div>
</div>
<p>Link to <a class="reference external" href="zonal-stats-pilbara.ipynb">stats within a polygon</a></p>
</div>
</div>
<div class="section" id="3.-Earth-Observation-(EO)-scientists-and-allied-domain-specialists-will-be-able-to-undertake-exploratory-data-analysis.-In-general-this-would-mean-a-user-will-be-able-to-easily-retrieve,-investigate,-visualise,-develop-algorithms,-test,-iterate,-visualise-results-and-interpret-them-in-the-context-of-other-spatio-temporal-datasets.">
<h2>3. Earth Observation (EO) scientists and allied domain specialists will be able to undertake exploratory data analysis. In general this would mean a user will be able to easily retrieve, investigate, visualise, develop algorithms, test, iterate, visualise results and interpret them in the context of other spatio-temporal datasets.<a class="headerlink" href="#3.-Earth-Observation-(EO)-scientists-and-allied-domain-specialists-will-be-able-to-undertake-exploratory-data-analysis.-In-general-this-would-mean-a-user-will-be-able-to-easily-retrieve,-investigate,-visualise,-develop-algorithms,-test,-iterate,-visualise-results-and-interpret-them-in-the-context-of-other-spatio-temporal-datasets." title="Permalink to this headline">¶</a></h2>
<p>A key demonstration of this capability will be the availability of
functions and data structures to enable Landsat/MODIS blending.</p>
<div class="section" id="Input-data">
<h3>Input data<a class="headerlink" href="#Input-data" title="Permalink to this headline">¶</a></h3>
<p>The AGDC will use the following data collections:  Landsat: TM, ETM+
and OLI/TIRS.  MODIS: Collection 6 MOD09 (granule) and MOD43
(sinusoidal tiles) that will provide variables necessary for the
Landsat-MODIS blending algorithm.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dc</span><span class="o">.</span><span class="n">list_products</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>It will also include the SRTM 3 second DSM and 1 and 3 second DEMs.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dc</span><span class="o">.</span><span class="n">list_measurements</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>At a minimum, the Australian implementation of the AGDC will cover all
of continental Australia plus a one tile buffer and the Great Barrier
Reef. However, the Boards preference would be for the Version 2 to also
cover all Commonwealth Marine Reserves.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_folium</span><span class="p">([</span>
    <span class="n">datasets_union</span><span class="p">(</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">search_eager</span><span class="p">(</span>
            <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls8_nbar_albers&#39;</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">Range</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<p>All data collections that are included in the Australian implementation
of the AGDC will:  Have a CC BY Attribution 3.0 or CC BY Attribution
4.0 license.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>ncdump -h <span class="s1">&#39;/g/data/rs0/datacube/002/LS5_TM_NBAR/14_-40/LS5_TM_NBAR_3577_14_-40_19860821231816000000.nc&#39;</span> <span class="p">|</span> grep license
</pre></div>
</div>
</div>
<p>The use of a collection with a different licence will require approval
of the AGDC Programme Board; and  Be in netCDF 4 format and will
comply with relevant CF conventions;.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">compliance_checker</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">compliance_checker</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">cf_units</span>
<span class="kn">from</span> <span class="nn">compliance_checker.runner</span> <span class="k">import</span> <span class="n">ComplianceChecker</span><span class="p">,</span> <span class="n">CheckSuite</span>
<span class="kn">from</span> <span class="nn">compliance_checker</span> <span class="k">import</span> <span class="n">__version__</span>

<span class="n">ds_loc</span> <span class="o">=</span> <span class="s1">&#39;/g/data/rs0/datacube/002/LS5_TM_NBAR/14_-40/LS5_TM_NBAR_3577_14_-40_19860821231816000000.nc&#39;</span>

<span class="n">cs</span> <span class="o">=</span> <span class="n">CheckSuite</span><span class="p">()</span>
<span class="n">cs</span><span class="o">.</span><span class="n">load_all_available_checkers</span><span class="p">()</span>

<span class="n">was_success</span><span class="p">,</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">ComplianceChecker</span><span class="o">.</span><span class="n">run_checker</span><span class="p">(</span>
    <span class="n">ds_loc</span><span class="o">=</span><span class="n">ds_loc</span><span class="p">,</span>
    <span class="n">checker_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cf&#39;</span><span class="p">],</span> <span class="c1"># &#39;acdd&#39;?</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">criteria</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
    <span class="n">output_filename</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="c1"># Skipping:</span>
    <span class="c1"># - check_dimension_order:</span>
    <span class="c1">#      Our files don&#39;t contain all the lats/lons as an auxiliary</span>
    <span class="c1">#      cordinate var as it&#39;s unnecessary for any software we&#39;ve</span>
    <span class="c1">#      tried.</span>
    <span class="c1">#      It may be added at some point in the future, and this check</span>
    <span class="c1">#      should be re-enabled.</span>
    <span class="n">skip_checks</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;check_dimension_order&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="c1"># missing source attribute: skippable according to Damien</span>
<span class="c1"># assert was_success, &quot;Compliance failed.&quot;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">help</span><span class="p">(</span><span class="n">ComplianceChecker</span><span class="o">.</span><span class="n">run_checker</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Output-Products">
<h2>Output Products<a class="headerlink" href="#Output-Products" title="Permalink to this headline">¶</a></h2>
<p>By June 30, 2016 the Australian implementation of the AGDC will ensure
that the products being produced are supported by and hosted on the RDS.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls /g/data/rs0/datacube/002
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>ls /g/data/fk4/datacube/002
</pre></div>
</div>
</div>
</div>
<div class="section" id="Technical-Requirements">
<h2>Technical Requirements<a class="headerlink" href="#Technical-Requirements" title="Permalink to this headline">¶</a></h2>
<p>In line with the use-case patterns outlined above, Version 2 will
support:  Data-fusion and analysis across heterogeneous gridded data
collections from different domains.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">albers_grid</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbart_albers&#39;</span><span class="p">,</span>
    <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;swir2&#39;</span><span class="p">,</span> <span class="s1">&#39;nir&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">],</span>
    <span class="o">**</span><span class="n">query</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sinusoidal_grid</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">,</span>
    <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;swir2&#39;</span><span class="p">,</span> <span class="s1">&#39;nir&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">],</span>
    <span class="n">output_crs</span><span class="o">=</span><span class="s1">&#39;PROJCS[&quot;unnamed&quot;,GEOGCS[&quot;Unknown datum based upon the custom spheroid&quot;,</span><span class="se">\</span>
<span class="s1">                DATUM[&quot;Not specified (based on custom spheroid)&quot;,</span><span class="se">\</span>
<span class="s1">                SPHEROID[&quot;Custom spheroid&quot;,6371007.181,0]],</span><span class="se">\</span>
<span class="s1">                PRIMEM[&quot;Greenwich&quot;,0],</span><span class="se">\</span>
<span class="s1">                UNIT[&quot;degree&quot;,0.0174532925199433]],</span><span class="se">\</span>
<span class="s1">                PROJECTION[&quot;Sinusoidal&quot;],</span><span class="se">\</span>
<span class="s1">                PARAMETER[&quot;longitude_of_center&quot;,0],</span><span class="se">\</span>
<span class="s1">                PARAMETER[&quot;false_easting&quot;,0],</span><span class="se">\</span>
<span class="s1">                PARAMETER[&quot;false_northing&quot;,0],</span><span class="se">\</span>
<span class="s1">                UNIT[&quot;Meter&quot;,1]]&#39;</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">250</span><span class="p">,</span><span class="mi">250</span><span class="p">),</span>
    <span class="o">**</span><span class="n">query</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_rgb</span><span class="p">(</span><span class="n">albers_grid</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">albers_grid</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_rgb</span><span class="p">(</span><span class="n">sinusoidal_grid</span><span class="p">,</span> <span class="mi">3500</span><span class="p">)</span>
<span class="n">sinusoidal_grid</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<p>Tuneable configuration, at ingest, of multidimensional files (eg.
chunking, compression type, dimension depth).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>datacube product add --help
</pre></div>
</div>
</div>
</div>
<div class="section" id="A-data-retrieval-mechanism-that-provides-the-ability-to:">
<h2>A data retrieval mechanism that provides the ability to:<a class="headerlink" href="#A-data-retrieval-mechanism-that-provides-the-ability-to:" title="Permalink to this headline">¶</a></h2>
<p>Obtain seamless subsets of data across storage unit boundaries;</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">seamless_query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2011-6-1&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-6-30&#39;</span><span class="p">),</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">132.0</span><span class="p">,</span> <span class="mf">132.01</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">seamless_subset</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">,</span>
    <span class="n">measurements</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;swir2&#39;</span><span class="p">,</span> <span class="s1">&#39;nir&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">],</span>
    <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">seamless_query</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">seamless_subset</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">seamless_subset</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="c1">#distance in metres</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">seamless_subset</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">seamless_subset</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="c1">#distance in metres</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">seamless_subset</span><span class="o">.</span><span class="n">extent</span><span class="o">.</span><span class="n">points</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot_rgb</span><span class="p">(</span><span class="n">seamless_subset</span><span class="p">,</span> <span class="mi">3000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># With the Grid Workflow class demonstrate seamless spatial query across tile boundaries</span>
<span class="kn">from</span> <span class="nn">datacube.api</span> <span class="k">import</span> <span class="n">GridWorkflow</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">gw</span> <span class="o">=</span> <span class="n">GridWorkflow</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The query straddles multiple tiles - indexes shown below</span>
<span class="n">gw</span><span class="o">.</span><span class="n">list_cells</span><span class="p">(</span>
    <span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">seamless_query</span>
<span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Filter data based on observation attribute (for example, pixel quality);</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>

<span></span><span class="c1"># Load some NDVI</span>
<span class="n">nbar</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls5_nbar_albers&#39;</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;solar_day&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">query</span><span class="p">)</span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="p">(</span><span class="n">nbar</span><span class="o">.</span><span class="n">nir</span> <span class="o">-</span> <span class="n">nbar</span><span class="o">.</span><span class="n">red</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nbar</span><span class="o">.</span><span class="n">nir</span> <span class="o">+</span> <span class="n">nbar</span><span class="o">.</span><span class="n">red</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span>
<span class="n">nbar</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Mask the valid data</span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="n">mask_invalid_data</span><span class="p">(</span><span class="n">ndvi</span><span class="p">)</span>
<span class="c1"># Create a mask for the data with artefacts</span>
<span class="n">good_pixels</span> <span class="o">=</span> <span class="n">masking</span><span class="o">.</span><span class="n">make_mask</span><span class="p">(</span><span class="n">pq</span><span class="p">,</span> <span class="n">ga_good_pixel</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Apply artefact mask</span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="n">ndvi</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">good_pixels</span><span class="o">.</span><span class="n">pixelquality</span><span class="p">)</span>

<span class="c1"># Plot the result</span>
<span class="n">ndvi</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlGn&#39;</span><span class="p">)</span>
<span class="n">ndvi</span> <span class="o">=</span> <span class="kc">None</span>

<span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
    <span class="n">masking</span><span class="o">.</span><span class="n">get_flags_def</span><span class="p">(</span><span class="n">pq</span><span class="p">),</span>
    <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span>
<span class="p">)</span>

</pre></div>
</div>
</div>
<p>Define the spatio-temporal range of interest independent of data storage
unit; and define the specific sensor or combination of sensor data to be
analysed.</p>
<p>Define the specific sensor or combination of sensor data to be analysed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">multi_sensor_query</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2013-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2014-01-01&#39;</span><span class="p">),</span>
    <span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">35.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">35.4</span><span class="p">),</span>
    <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">149.0</span><span class="p">,</span> <span class="mf">149.2</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ls7_nbar_albers&#39;</span><span class="p">,</span> <span class="s1">&#39;ls8_nbar_albers&#39;</span><span class="p">]</span>

<span class="c1"># Find similarly named measurements</span>
<span class="n">measurements</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">get_by_name</span><span class="p">(</span><span class="n">products</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">products</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">measurements</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">dc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">get_by_name</span><span class="p">(</span><span class="n">products</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">prod</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">prod</span><span class="p">,</span> <span class="n">measurements</span><span class="o">=</span><span class="n">measurements</span><span class="p">,</span> <span class="o">**</span><span class="n">multi_sensor_query</span><span class="p">)</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;product&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">prod</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

<span class="n">combined</span> <span class="o">=</span> <span class="n">xarray</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">combined</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">combined</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">argsort</span><span class="p">())</span>  <span class="c1"># sort along time dim</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">combined</span><span class="o">.</span><span class="n">swir1</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col_wrap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">robust</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;rainbow&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The API will provide a simplified conceptual model for data query and
analysis based on an n-dimensional array abstraction;</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">combined</span><span class="o">.</span><span class="n">data_vars</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">combined</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<p>During EDA, lazy evaluation of calculations so only those results that
are in use are computed; and</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># CSIRO Peter Wang - link to notebook</span>
</pre></div>
</div>
</div>
<p>Support for calculations on arrays that are larger than core memory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Dask Example</span>
<span class="n">lazydata</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
    <span class="n">product</span><span class="o">=</span><span class="s1">&#39;ls7_nbart_albers&#39;</span><span class="p">,</span>
    <span class="n">longitude</span><span class="o">=</span><span class="p">(</span><span class="mf">132.0</span><span class="p">,</span> <span class="mf">137.0</span><span class="p">),</span>
    <span class="n">latitude</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">),</span>
    <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;2011-6-1&#39;</span><span class="p">,</span> <span class="s1">&#39;2011-6-30&#39;</span><span class="p">),</span>
    <span class="n">dask_chunks</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">dask.dot</span> <span class="k">import</span> <span class="n">dot_graph</span>

<span class="n">dot_graph</span><span class="p">(</span><span class="n">lazydata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">lazydata</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># If larger than memory will be chunked and run</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lazydata</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Visualise doesn&#39;t seem to exist anymore?</span>
<span class="c1"># lazydata.blue.visualise()</span>
</pre></div>
</div>
</div>
<p>Continental scale product generation will be based off the continental
workflows from the current ADGC v1 API, however it will be modified to
use the version 2 data retrieval mechanism.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># See stats, wofs and ingestion</span>
</pre></div>
</div>
</div>
<p>The ability to manage results of calculations as a temporary/private
data cube for further analysis.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># See remote cube example above</span>
</pre></div>
</div>
</div>
<p>Web based delivery of products through WMS, WCS, CS/W, OpenDAP services.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>firefox http://dapds00.nci.org.au/thredds/catalogs/rs0/catalog.html
</pre></div>
</div>
</div>
<p>Basic provenance that records information about an analysis
result/product such as what datasets, software version, ancillary data
and algorithm was used to produce the product. Wherever possible,
Version 2 will adopt and adapt existing software, services and
standards.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#combined.variables</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># See sources example above</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Other-Requirements">
<h2>Other Requirements<a class="headerlink" href="#Other-Requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="The-Project-Plan-will-be-supported-by:">
<h3>The Project Plan will be supported by:<a class="headerlink" href="#The-Project-Plan-will-be-supported-by:" title="Permalink to this headline">¶</a></h3>
<p> A transition plan and timetable for moving AGDC production from
Version 1 to Version 2 of the AGDC (including controlled updates to data
collections that are already accessible via RDS);</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>firefox http://dapds00.nci.org.au/thredds/catalogs/rs0/catalog.html
</pre></div>
</div>
</div>
<p>A software release and management plan;</p>
<p>Approved by Robert Woodcock, Matt Paget and Simon Oliver 19/01/2016</p>
<ol class="arabic simple">
<li>Develop branch - aim is to have this not broken - integration tests
should enforce expected functionality on this branch</li>
</ol>
<ol class="loweralpha simple">
<li>integration tests are trying to enforce this</li>
<li>Develop is the main collaboration branch</li>
<li>To discourage keeping feature branches separate for too long - small
incremental improvements are better</li>
</ol>
<ol class="arabic simple" start="2">
<li>Master to be replaced with git tagged releases (these should not
deviate greatly from develop)</li>
</ol>
<ol class="loweralpha simple">
<li>The process to get to release could be :</li>
<li>Decide when develop is feature complete</li>
</ol>
<ol class="lowerroman" start="2">
<li><p class="first">Branch it to a release candidate</p>
</li>
<li><div class="first highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span> <span class="n">the</span> <span class="n">release</span> <span class="n">candidate</span> <span class="p">(</span><span class="n">manual</span> <span class="o">-</span> <span class="n">apply</span> <span class="n">patches</span> <span class="k">as</span> <span class="n">needed</span> <span class="n">to</span> <span class="n">branch</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Tag release</p>
</li>
</ol>
<ol class="arabic simple" start="3">
<li>Continuous integration tests are run on every checkin to check core
functionality- currently includes all of the ingestion code - in the
process of extending to include storage access.</li>
</ol>
<ol class="loweralpha simple">
<li>To merge in a feature branch it should include any relevant tests.</li>
</ol>
<ol class="arabic simple" start="4">
<li>Persistent demo environment to be set up on Raijin with major changes
going in - accessible to NCI/CSIRO and GA - only updated when we are
going to do a release i.e. against the release candidate (as a final
check)</li>
</ol>
<ol class="loweralpha simple">
<li>Aim to have pushbutton releases to raijin (nightly build)</li>
</ol>
<ol class="arabic simple" start="5">
<li>We should be doing user acceptance tests also and need to agree on
what this looks like prior to approving a release.</li>
</ol>
<p>A plan for improving the data management of the collections in the RDS
Landsat (rs0) and WOfs (fk4) Projects, such as establishing data layout,
appropriate access controls (including read/write permissions) and
alignment to existing organisational data libraries);  Reformatting of
all data in projects rs0 (Landsat) and fk4 (WOfS) that are currently
stored in GeoTIFF into netCDF4-CF;</p>
<p>An AGDC database API which can provide a base for further AGDC
developments and that can accommodate updates in the internal structure
of netCDF4-CF;</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Looks like a good base? Not sure what update to internal structure in NetCDF actually means...</span>
</pre></div>
</div>
</div>
<p>Upgrading all documentation (including Data Management Plans, Product
Specifications, etc.) and ensuring that any Metadata is compliant with
the requirements of the Australian Government Spatial Data Policies and
Directives, the Australian National Data Service and data.gov.au; and</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#</span>
</pre></div>
</div>
</div>
<p> </p>
<p>Benchmarks and Quality Assurance tests to validate the quality of the
access that is required by the agreed use-cases.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">notebook_end_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="s1">&#39;Finished in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">notebook_end_dt</span> <span class="o">-</span> <span class="n">notebook_start_dt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="goalkeeper_instructions.html" class="btn btn-neutral" title="What’s a Goalkeeper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Geoscience Australia.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script>


<!-- Theme Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113800428-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());
 
 gtag('config', 'UA-113800428-1');
</script>

    
  


</body>
</html>